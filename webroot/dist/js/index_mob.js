!function(t){var n={};function i(e){if(n[e])return n[e].exports;var o=n[e]={i:e,l:!1,exports:{}};return t[e].call(o.exports,o,o.exports,i),o.l=!0,o.exports}i.m=t,i.c=n,i.d=function(e,o,t){i.o(e,o)||Object.defineProperty(e,o,{enumerable:!0,get:t})},i.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},i.t=function(o,e){if(1&e&&(o=i(o)),8&e)return o;if(4&e&&"object"==typeof o&&o&&o.__esModule)return o;var t=Object.create(null);if(i.r(t),Object.defineProperty(t,"default",{enumerable:!0,value:o}),2&e&&"string"!=typeof o)for(var n in o)i.d(t,n,function(e){return o[e]}.bind(null,n));return t},i.n=function(e){var o=e&&e.__esModule?function(){return e.default}:function(){return e};return i.d(o,"a",o),o},i.o=function(e,o){return Object.prototype.hasOwnProperty.call(e,o)},i.p="",i(i.s=14)}([function(e,o,t){"use strict";var n,i,s,a;o.__esModule=!0,(i=n=n||{})[i.Working=100]="Working",i[i.Stopping=101]="Stopping",(a=s=s||{})[a.VideoSystemUnInit=100]="VideoSystemUnInit",a[a.VideoSystemUnIniting=200]="VideoSystemUnIniting",a[a.VideoSystemInitSucc=300]="VideoSystemInitSucc",a[a.VideoSystemInitFailed=400]="VideoSystemInitFailed";var r=function(){this.AudioRecording=!1,this.VideoChatting=!1,this.VideoSystemStatus=s.VideoSystemUnInit},l=(c.CoreMessageLoopTime=100,c.globalProcessStatus=n.Working,c.protocol="ws://",c.globalBackgroundImg="",c.globalUserID=-1,c.globalPwd="",c.globalMobile=!1,c.globalLoginPage="index.html",c.globalRegisterPage="new.html",c.globalMainPage="main.html",c.NoteglobalVideoSystemStatusObject=new r,c.username="",c.globalFriendsId=[],c.globalMessageArray=[],c.sakdasjdhakd9aqwieyqwieyi="4F637416",c);function c(){}o.GlobalVars2=l,o.audioorvideoWorking=function(){return l.NoteglobalVideoSystemStatusObject.AudioRecording||l.NoteglobalVideoSystemStatusObject.VideoChatting},o.audioWorking=function(){return l.NoteglobalVideoSystemStatusObject.AudioRecording},o.turnOffAudio=function(){l.NoteglobalVideoSystemStatusObject.AudioRecording=!1},o.turnOnAudion=function(){l.NoteglobalVideoSystemStatusObject.AudioRecording=!0},o.turnOffvideo=function(){l.NoteglobalVideoSystemStatusObject.VideoChatting=!1},o.turnOnvideo=function(e){l.NoteglobalVideoSystemStatusObject.VideoChatting=!0},o.isVideoSystemNeedInite=function(){return l.NoteglobalVideoSystemStatusObject.VideoSystemStatus==s.VideoSystemUnInit},o.isVideoSystemIniting=function(){return l.NoteglobalVideoSystemStatusObject.VideoSystemStatus==s.VideoSystemUnIniting},o.isVideoSystemInitSucc=function(){return l.NoteglobalVideoSystemStatusObject.VideoSystemStatus!=s.VideoSystemInitSucc},o.startProcessCoreMessage=function(){l.globalProcessStatus=n.Working},o.stopProcessCoreMessage=function(){l.globalProcessStatus=n.Stopping},o.isProcessCoreMessageWorking=function(){return l.globalProcessStatus==n.Working},o.getOpenWidth=function(){return!0===l.globalMobile?"400px;":"560px;"},o.changeBackground=function(){var e=Math.round(100*Math.random())+1,o=(e%=38).toString()+".jpg";o="../images/bg/img/"+(o=e<10?"0000"+o:"000"+o),l.globalBackgroundImg="url("+o+")",document.getElementsByTagName("body")[0].style.backgroundImage=l.globalBackgroundImg},o.sendMessageToServer=function(e){var o=e.cmd+l.sakdasjdhakd9aqwieyqwieyi+JSON.stringify(e);console.log("send message ",o),l.globalImSocketObject.send(o)}},function(e,o,t){"use strict";o.__esModule=!0;var n=(i.Request_register_code="001",i.Request_login_code="011",i.Request_online_client_info_code="002",i.Response_online_client_info_code="102",i.Response_login_code="111",i.Response_mine_code="121",i.Response_add_friend_list_code="131",i.Request_a_to_server_add_friend_code="032",i.Request_server_to_b_add_friend_code="032",i.Response_server_to_a_add_friend_code="133",i.Request_confirm_add_friend_code="033",i.Request_fetch_friend_code="037",i.Response_server_to_a_fetch_friend_code="137",i.Request_remove_friend_code="039",i.Response_remove_friend_code="139",i.Request_message_code="041",i.Requst_ack_message_code="042",i.Response_message_code="142",i.Response_friend_status_change_code="151",i.Response_friend_info_change_code="152",i.Request_video_chat_a_to_server_code="053",i.Response_video_chat_server_to_a_code="153",i.Request_video_chat_b_to_server_code="054",i.Response_video_chat_server_to_b_code="154",i.Request_client_to_server_video_was_stopped_code="055",i.Response_server_to_client_video_was_stopped_code="155",i.LOGIN_CMD="login",i.OFFER_CMD="offer",i.ANSWER_CMD="answer",i.CANDIDATE_CMD="candidate",i.LEAVE_CMD="leave",i);function i(){}o.GlobalCode=n},function(e,o,t){"use strict";o.__esModule=!0;function n(){}o.RequsetSignin=n;function i(){}o.ResponseAddList=i;function s(){}o.ChatMessage=s;function a(){}o.AckChatMessage=a;function r(){}o.AddFriendRequest=r;function l(){}o.AddFriendResponse=l;function c(){}o.SetFriendStatusResponse=c;function d(){}o.ConfirmAddFriendRequest=d;function u(){}o.RequestFetchFriendInfo=u;function g(){}o.ResponseFetchFriendInfo=g;function b(){}o.ResponseMine=b;function m(){}o.RequestUserRegister=m;function f(){}o.ResponseUserRegister=f;function h(){}o.ResponseSignin=h;function p(){}o.UserInfo=p;function S(){}o.RequestRemoveFriend=S;function _(){}o.ResponseRemoveFriend=_;function y(){}o.RequestVideoChatClosed=y;function C(){}o.VideoChatMsg=C;function v(){}o.LoginWebRtcRoom=v;function V(){}o.Candidate=V;function w(){}o.Answer=w;function G(){}o.Offer=G;function R(){}o.WebRTCJson=R},function(e,o,t){"use strict";o.__esModule=!0;var n=t(0),i=Domain,s=i+":3478",a=i+":3478";var r=(l.uploaderSocketServer=i+":8091",l.ImServer=i+":8090",l.signallingConnectionServer=i+":8888",l.stunServerConfigString='[{ "urls": "stun:'+s+'?transport=udp"   } ,{ "urls": "stun:'+s+'?transport=tcp"   } ,{ "urls": "turn:'+a+'?transport=udp",  "username": "k1",  "credential": "1234567" } ,{ "urls": "turn:'+a+'?transport=tcp",  "username": "k1",  "credential": "1234567" } ] ',l);function l(){}o.GlobalVars=r,"https:"===document.location.protocol&&(n.GlobalVars2.protocol="wss://"),console.log("GlobalVars2.protocol  ",n.GlobalVars2.protocol),r.uploaderSocketServer=n.GlobalVars2.protocol+r.uploaderSocketServer,r.ImServer=n.GlobalVars2.protocol+r.ImServer,r.signallingConnectionServer=n.GlobalVars2.protocol+r.signallingConnectionServer,console.log("GlobalVars.uploaderSocketServer  ",r.uploaderSocketServer),console.log("GlobalVars.ImServer   ",r.ImServer),console.log("GlobalVars.signallingConnectionServer  ",r.signallingConnectionServer)},function(e,o,t){"use strict";o.__esModule=!0;var a=t(0),s=t(1),n=t(2),i=t(3),r=t(5),l=(c.prototype.initFirstVideoChatMsg=function(){this.firstVideoChatInit=!0},c.prototype.cleanFirstVideoChatMsg=function(){this.firstVideoChatInit=!1},c.prototype.isFirstVideoChatInited=function(){return this.firstVideoChatInit},c.prototype.createFirstVideoChat=function(e,o){if(!this.isFirstVideoChatInited()){this.firstVideoChatInit=!0,this.firstVideoChat.localsession=Math.round(1e4*Math.random())+200;var t=$(e).attr("data-json"),n=decodeURIComponent(t),i=JSON.parse(n);this.firstVideoChat.clienta=a.GlobalVars2.globalUserID,this.firstVideoChat.clientb=parseInt(i.id,10),this.firstVideoChat.audiochatonly=o,this.firstVideoChat.cmd=s.GlobalCode.Request_video_chat_a_to_server_code,console.log("createFirstVideoChat ：localsession:",this.firstVideoChat.localsession)}},c.prototype.updateMyFirstVideoChat=function(e){this.firstVideoChatInit=!0,this.firstVideoChat=e},c.prototype.getSingalRequest=function(){if(this.firstVideoChatInit){var e=new n.WebRTCJson;return e.clienta=this.firstVideoChat.clienta,e.clientb=this.firstVideoChat.clientb,e.whoami=a.GlobalVars2.globalUserID,e.localsession=this.firstVideoChat.localsession,e.roomid=this.firstVideoChat.roomid,e.fromavatar=this.firstVideoChat.fromavatar,e.roomtoken=this.firstVideoChat.roomtoken,e.requestid=this.firstVideoChat.requestid,e.sessionid=this.firstVideoChat.sessionid,e}alert("wrong Request")},c.prototype.getSingalVideoChat=function(){if(this.firstVideoChatInit)return this.firstVideoChat;alert("wrong Request")},c.prototype.cleanLocalSession=function(){this.firstVideoChatInit=!1,this.firstVideoChat.localsession=0,this.firstVideoChat.clientb=0,this.firstVideoChat.clientb=0,console.log("cleanLocalSession ：localsession:",this.firstVideoChat.localsession)},c.prototype.equalLocalSession=function(e){return!!this.isFirstVideoChatInited()&&this.firstVideoChat.localsession==e},c);function c(){this.firstVideoChat=new n.VideoChatMsg,this.firstVideoChat.localsession=0,this.firstVideoChatInit=!1,this.snid=Math.round(1e4*Math.random())+200,this.yourConnectionInitFlag=!1,console.log("constructor VideoSystemObj ",this.snid)}o.VideoSystemObj=l;var d=function(){};function u(){d.GlobalVideoSystem.signalSocket=new WebSocket(i.GlobalVars.signallingConnectionServer),d.GlobalVideoSystem.signalSocket.onopen=function(){console.log("user:  connect success. "+i.GlobalVars.signallingConnectionServer+" ");var e=d.GlobalVideoSystem.getSingalRequest();e.type=s.GlobalCode.LOGIN_CMD,G(e)},d.GlobalVideoSystem.signalSocket.onclose=function(e){console.log("webrtc connection closed")},d.GlobalVideoSystem.signalSocket.onmessage=function(o){var e;try{e=JSON.parse(o.data),console.log("got message",o.data)}catch(e){return void console.log("parse json failed",e,"res.data",o.data)}switch(console.log("got ",e.type),e.type){case s.GlobalCode.LOGIN_CMD:d.GlobalVideoSystem.getSingalRequest().clienta==a.GlobalVars2.globalUserID&&V();break;case s.GlobalCode.OFFER_CMD:f(e.offer);break;case s.GlobalCode.ANSWER_CMD:h(e.answer);break;case s.GlobalCode.CANDIDATE_CMD:p(e.candidate);break;default:console.log("unknow command",e)}}}function g(){d.GlobalVideoSystem.yourConnectionInitFlag=!0}function b(){return d.GlobalVideoSystem.yourConnectionInitFlag}function m(){d.GlobalVideoSystem.yourConnectionInitFlag=!1}function f(e){console.log("recvOfferMsg "),console.log("recvOfferMsg yourConnection.setRemoteDescription"),d.GlobalVideoSystem.yourConnection.setRemoteDescription(new RTCSessionDescription(e)),console.log("recvOfferMsg yourConnection.createAnswer"),d.GlobalVideoSystem.yourConnection.createAnswer(function(e){console.log("yourConnection.setLocalDescription (answer)"),d.GlobalVideoSystem.yourConnection.setLocalDescription(e);var o=d.GlobalVideoSystem.getSingalRequest();o.type=s.GlobalCode.ANSWER_CMD,o.answer=e,G(o)},function(e){alert("An error has occurred")})}function h(e){console.log("recvAnswerMsg "),console.log("recvAnswerMsg yourConnection.setRemoteDescription"),d.GlobalVideoSystem.yourConnection.setRemoteDescription(new RTCSessionDescription(e))}function p(e){console.log("recvCandidateMsg"),console.log("recvCandidateMsg yourConnection.addIceCandidate",JSON.stringify(e)),d.GlobalVideoSystem.yourConnection.addIceCandidate(new RTCIceCandidate(e))}function S(){console.log("initVideoSystem"),d.GlobalVideoSystem.callPage=document.querySelector("#call-page"),d.GlobalVideoSystem.hangUpButton=document.querySelector("#hang-up"),d.GlobalVideoSystem.yourVideo=document.querySelector("#yours"),d.GlobalVideoSystem.theirVideo=document.querySelector("#theirs"),$("#call-page").hide(),a.GlobalVars2.globalMobile||d.GlobalVideoSystem.hangUpButton.addEventListener("click",function(){w()})}function _(e){if(console.log("startConnection() 1"),C()){console.log("startConnection() 2");var o=!0;1==e&&(o=!1),navigator.getUserMedia({video:o,audio:{echoCancellation:!0}},function(e){d.GlobalVideoSystem.stream=e,d.GlobalVideoSystem.yourVideo.src=window.URL.createObjectURL(d.GlobalVideoSystem.stream),v()?(console.log("startConnection() 3"),console.log("hasRTCPeerConnection success"),y(d.GlobalVideoSystem.stream)):alert("Sorry, your browser does not support WebRTC.")},function(e){console.log(e)})}else alert("Sorry, your browser does not support WebRTC.")}function y(e){var o={iceServers:JSON.parse(i.GlobalVars.stunServerConfigString),bundlePolicy:"max-bundle"};console.log("setupPeerConnection(stream);"),console.log("yourConnection = new RTCPeerConnection(configuration)",JSON.stringify(o)),d.GlobalVideoSystem.yourConnection=new RTCPeerConnection(o),g(),console.log("yourConnection.addStream(stream);"),d.GlobalVideoSystem.yourConnection.addStream(e),d.GlobalVideoSystem.yourConnection.onaddstream=function(e){d.GlobalVideoSystem.theirVideo.src=window.URL.createObjectURL(e.stream)},d.GlobalVideoSystem.yourConnection.onicecandidate=function(e){if(console.log("yourConnection.onicecandidate",e),e.candidate){var o=d.GlobalVideoSystem.getSingalRequest();o.type=s.GlobalCode.CANDIDATE_CMD,o.candidate=e.candidate,G(o)}},console.log("setupPeerConnection(stream) done;"),u()}function C(){return navigator.getUserMedia=navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia||navigator.msGetUserMedia,!!navigator.getUserMedia}function v(){return window.RTCPeerConnection=window.RTCPeerConnection||window.webkitRTCPeerConnection||window.mozRTCPeerConnection,window.RTCSessionDescription=window.RTCSessionDescription||window.webkitRTCSessionDescription||window.mozRTCSessionDescription,window.RTCIceCandidate=window.RTCIceCandidate||window.webkitRTCIceCandidate||window.mozRTCIceCandidate,!!window.RTCPeerConnection}function V(){d.GlobalVideoSystem.yourConnection.createOffer(function(e){console.log("yourConnection.createOffer(function (offer)");var o=d.GlobalVideoSystem.getSingalRequest();o.type=s.GlobalCode.OFFER_CMD,o.offer=e,G(o),d.GlobalVideoSystem.yourConnection.setLocalDescription(e)},function(e){alert("An error has occurred.")})}function w(){d.GlobalVideoSystem.connectedUser=null,d.GlobalVideoSystem.theirVideo.src=null,d.GlobalVideoSystem.yourVideo.src=null,b()&&(d.GlobalVideoSystem.yourConnection.close(),d.GlobalVideoSystem.yourConnection.onicecandidate=null,d.GlobalVideoSystem.yourConnection.onaddstream=null),m(),void 0!==d.GlobalVideoSystem.signalSocket&&void 0!==d.GlobalVideoSystem.signalSocket.close&&d.GlobalVideoSystem.signalSocket.close();a.GlobalVars2.globalLayImObj.cache();var e=d.GlobalVideoSystem.getSingalRequest();e.iam=a.GlobalVars2.globalUserID,e.cmd=s.GlobalCode.Request_client_to_server_video_was_stopped_code,a.sendMessageToServer(e),d.GlobalVideoSystem.cleanLocalSession(),M(),$("#remotemessage").html("")}function G(e){var o=d.GlobalVideoSystem.signalSocket,t=JSON.stringify(e);console.log("send message to SingalServer ",t),o.send(t)}function R(){$("#call-page").css("position","absolute"),$("#call-page").css("top",0),$("#call-page").css("left",0),$("#call-page").css("background","#ccc");var e=r.getWH(1);$("#call-page")[0].style.cssText+=";width:"+e.w+"px;height:"+e.h+"px";var o=r.findHighestZIndex("div");console.log("max z: ",o," w: ",e.w,NaN,e.h),$("#call-page").css("z-index",o+1),$("#call-page").css("visibility","visible"),$("#call-page").css("background-image",a.GlobalVars2.globalBackgroundImg),$("#call-page").show()}function k(){var e,o,t,n=window.screen.availHeight,i=window.screen.availWidth;console.log("w:"+i.toString()+" h: "+n.toString()),e=.75*(n*=.9),o=.75*(i*=.9),e=parseInt(e.toFixed()),o=parseInt(o.toFixed()),(i*=.9)<(n*=.9)&&(n=i),t=.8*(i=n=parseInt(n.toFixed())),t=parseInt(t.toFixed()),console.log("w:"+i.toString()+" h: "+n.toString()+" w2: "+t.toString());var s='  <table id="call-page"     style=" top:0px; left: 0px; witdth: '+n.toString()+"px; height: "+i.toString()+'px; ">\n\n\n    <table class="page" >\n\n\n        <video id="yours"   autoplay playsinline controls></video>\n        <video id="theirs"  style="  witdth: '+t.toString()+"px; height:"+t.toString()+'px; " autoplay playsinline controls  ></video>\n\n         \n<div id ="remotemessage"></div>    </table>\n</table>';console.log("['"+e.toString()+"px', '"+o.toString()+"px']"),a.GlobalVars2.Global_layer.open({type:1,title:!1,closeBtn:!1,area:"['"+o.toString()+"px', '"+e.toString()+"px']",shade:.8,btn:["关闭视频"],btnAlign:"c",moveType:1,content:s,yes:function(e,o){w(),a.GlobalVars2.Global_layer.close(e),a.startProcessCoreMessage()}}),$("#theirs").css("width",n.toString()+"px"),$("#theirs").css("height",n.toString()+"px"),$("#yours").css("width","80px"),$("#yours").css("height","80px"),$("#call-page").css("width",o.toString()+"px"),$("#call-page").css("height",e.toString()+"px"),S()}function M(){a.GlobalVars2.globalMobile||($("#micmask").css("z-index",-1),$("#call-page").css("visibility","hidden"),$("#call-page").hide())}o.GlobalVars3=d,o.callVeidoSingalServer=function(e){_((d.GlobalVideoSystem.firstVideoChat=e).audiochatonly)},o.startWebRTCLoop=u,o.initYourConnectionFlag=g,o.checkYourConnectionInitFlag=b,o.cleanYourConnectionInitFlag=m,o.recvOfferMsg=f,o.recvAnswerMsg=h,o.recvCandidateMsg=p,o.initVideoSystem=S,o.recvLoginMsg=function(e){!1===e?alert("Login unsuccessful, please try a different name."):d.GlobalVideoSystem.callPage.style.display="block"},o.startConnection=_,o.setupPeerConnection=y,o.hasUserMedia=C,o.hasRTCPeerConnection=v,o.startPeerConnection=V,o.recvLeaveMsg=w,o.sendMessageToSingalServer=G,o.showCallPage=function(){console.log("showCallPage()"),a.GlobalVars2.globalMobile?k():R()},o.showCallPagePC=R,o.showCallPageMobile=k,o.hideCallPage=M},function(e,i,o){"use strict";i.__esModule=!0;var s,a,t,n,r,l,c=o(3),d=o(0);i.getWH=(t=document,n=t["CSS1Compat"==t.compatMode?"documentElement":"body"],function(e){return{w:n[(e?"client":"scroll")+"Width"],h:e?n.clientHeight:Math.max(n.clientHeight,n.scrollHeight)}}),(l=r=r||{})[l.needInitAudio=100]="needInitAudio",l[l.AudioInitializing=150]="AudioInitializing",l[l.initSuccess=200]="initSuccess",l[l.initFailed=300]="initFailed";var u,g=r.needInitAudio;function b(e){g=r.initSuccess;var o=s.createMediaStreamSource(e);console.log("Media stream created."),a=new Recorder(o),console.log("Recorder initialised."),h(u)}function m(e){console.log("stopRecording(node)",e),a?console.log("stopRecording(node) recorder is ready"):console.log("stopRecording(node) recorder is not ready"),a&&a.stop(),console.log("Stopped recording."),function(o){a&&a.exportWAV(function(e){!function(e,t){var n=new WebSocket(c.GlobalVars.uploaderSocketServer);n.onopen=function(){console.log("user:  connect success"+c.GlobalVars.uploaderSocketServer),n.send(e)},n.onclose=function(e){console.log("user:  connect close",e)},n.onmessage=function(e){console.log(e);var o=JSON.parse(e.data);console.log("message: "+o.path),n.close(),!1===d.GlobalVars2.globalMobile?function(e,o){e.children(".layim-chat-textarea").children()[0].value="audio["+o.path+"]",e.children(".layim-chat-bottom").find(".layim-send-btn").trigger("click")}(t,o):function(e,o){var t=e.children(".layim-chat-send").children();t[0].value="audio["+o.path+"]";var n=$(t[1]);n.offset().left,n.offset().top;3,3;$("body")}(t,o)}}(e,o)})}(e),a.clear()}function f(e){for(var o=document.getElementsByTagName(e),t="0",n=0;n<o.length;n++){var i=document.defaultView.getComputedStyle(o[n],null).getPropertyValue("z-index");Number(i)>Number(t)&&"auto"!=i&&(t=i)}return Number(t)}function h(e){console.log("audioMessage()",e);var o=$(e).attr("data-json"),t=decodeURIComponent(o),n=(JSON.parse(t),$(e).parent().parent());console.log("AudioDeviceNeedInit"),(g===r.needInitAudio?(console.log("AudioDeviceNeedInit true"),0):(console.log("AudioDeviceNeedInit false"),1))?(console.log("AudioDeviceInitializing"),(g===r.AudioInitializing?(console.log("AudioDeviceInitializing true"),0):(console.log("AudioDeviceInitializing false"),1))&&(g===r.initSuccess?d.audioWorking()?(m(n),$("#AudioRecording").hide(),$("#micmask").remove(),d.turnOffAudio()):(d.turnOnAudion(),function(e){$(document.body).append("<div id=\"micmask\"> <img src='../images/bg/mic.png?__inline'></div>"),$("#micmask").css("position","absolute"),$("#micmask").css("top",0),$("#micmask").css("left",0),$("#micmask").css("background","#ccc");var o=i.getWH(1);$("#micmask")[0].style.cssText+=";width:"+o.w+"px;height:"+o.h+"px";var t=f("div");console.log("max z: ",t," w: ",o.w,NaN,o.h),$("#micmask").css("z-index",t+1),$("#micmask").on("click",function(){$("#micmask").remove(),h(e)})}(e),$("#AudioRecording").show(),console.log("startRecording()"),a?console.log("startRecording( ) recorder is ready"):console.log("startRecording( ) recorder is not ready"),a&&a.record(),console.log("Recording...")):alert("no device"))):function(e){console.log("InitUserMediaSystem"),g=r.AudioInitializing;try{window.AudioContext=window.AudioContext||window.webkitAudioContext,navigator.getUserMedia=navigator.getUserMedia||navigator.webkitGetUserMedia,window.URL=window.URL||window.webkitURL,s=new AudioContext,console.log("Audio context set up."),console.log("navigator.getUserMedia "+(navigator.getUserMedia?"available.":"not present!"))}catch(e){return alert("No web audio support in this browser!"),g=r.initFailed}u=e,navigator.getUserMedia({audio:!0},b,function(e){console.log("No live audio input: "+e),g=r.initFailed})}(e)}i.findHighestZIndex=f,i.audioMessage=h},function(e,o,t){"use strict";function n(e,o,t){var n=new Date;n.setDate(n.getDate()+t),document.cookie=e+"="+escape(o)+(null==t?"":"; expires="+n.toUTCString())}o.__esModule=!0,o.getCookie=function(e){if(0<document.cookie.length){var o=document.cookie.indexOf(e+"=");if(-1!=o){o=o+e.length+1;var t=document.cookie.indexOf(";",o);return-1==t&&(t=document.cookie.length),unescape(document.cookie.substring(o,t))}}return""},o.setCookie=n,o.delCookie=function(e){n(e,"",-1)}},function(e,o,t){"use strict";o.__esModule=!0;var a=t(0),r=t(1),l=t(2),i=t(4);o.dispatchResultFormSocketServer=function(e){switch(e.cmd){case r.GlobalCode.Response_login_code:a.GlobalVars2.globalMessageArray.push(e),console.log("push "+e);break;case r.GlobalCode.Response_mine_code:var o=e,t=a.GlobalVars2.globalLayImObj.cache();t.mine.id=o.id.toLocaleString(),t.mine.avatar=o.avatar,t.mine.username=o.username,t.mine.sign=o.sign,$(".layui-layim-user").html(t.mine.username),$(".layui-layim-remark").val(t.mine.sign);break;case r.GlobalCode.Response_add_friend_list_code:o=e;e.id=o.id.toString(),a.GlobalVars2.globalFriendsId.push(o.id),a.GlobalVars2.globalLayImObj.addList(e);break;case r.GlobalCode.Response_server_to_a_add_friend_code:case r.GlobalCode.Response_server_to_a_fetch_friend_code:a.GlobalVars2.globalMessageArray.push(e),console.log("push "+e.cmd+e);break;case r.GlobalCode.Response_message_code:a.GlobalVars2.globalLayImObj.getMessage(e);var n=new l.AckChatMessage;n.cmd=r.GlobalCode.Requst_ack_message_code,n.gid=e.gid,a.sendMessageToServer(n);break;case r.GlobalCode.Response_friend_status_change_code:o=e;a.GlobalVars2.globalLayImObj.setFriendStatus(o.id,o.status);break;case r.GlobalCode.Request_server_to_b_add_friend_code:case r.GlobalCode.Response_video_chat_server_to_a_code:case r.GlobalCode.Response_video_chat_server_to_b_code:a.GlobalVars2.globalMessageArray.push(e);break;case r.GlobalCode.Response_server_to_client_video_was_stopped_code:!function(e){if(!i.GlobalVars3.GlobalVideoSystem.equalLocalSession(e.localsession))return;$("#remotemessage").html("对方已经挂机！！"),$("#remotemessage").css("color","red")}(o=e);break;case r.GlobalCode.Response_remove_friend_code:o=e;a.GlobalVars2.globalLayImObj.removeList({type:"friend",id:o.friendid});break;default:console.log("unknow command",e.cmd,e)}},o.removeThisFriend=function(e){var o,t=$(e).attr("data-json"),n=decodeURIComponent(t),i=JSON.parse(n);o='<div style="padding: 50px; line-height: 22px; background-color: #393D49; color: #fff; font-weight: 300;"> 你确定要删除 这位好友吗？',o+='<table class="layui-table"  style="background-color: #393D49;">',o+=" <colgroup>",o+='  <col width="150">',o+=' <col width="200">',o+=" <col>",o+="</colgroup>",o+="<thead>",o+='<tr style="background-color: #393D49;">',o+="<th>昵称</th>",o+="<th>头像</th>",o+="<th>签名</th>",o+="</tr>",o+="</thead>",o+="<tbody>",o+="<tr>",o+="<td> "+i.name+"</td>",o+='<td><img style="width: 150px; height:150px;" src="'+i.avatar+'"></td>',o+="<td> "+i.remark+" </td>",o+="   </tr>",o+="</tbody>",o+="</table>",o+=" </div>";var s=new l.RequestRemoveFriend;s.cmd=r.GlobalCode.Request_remove_friend_code,s.friendid=parseInt(i.id,10),a.GlobalVars2.Global_layer.open({type:1,title:!1,closeBtn:!1,area:a.getOpenWidth(),shade:.8,btn:["删除用户","还是保留吧"],btnAlign:"c",moveType:1,content:o,yes:function(e,o){a.sendMessageToServer(s),a.startProcessCoreMessage(),a.GlobalVars2.Global_layer.close(e)},btn2:function(e,o){a.startProcessCoreMessage(),a.GlobalVars2.Global_layer.close(e)}})}},function(e,o,t){"use strict";o.__esModule=!0;var n=t(0),i=t(4),s=t(1);o.videoChat=function(e){if(!n.audioorvideoWorking()&&!i.GlobalVars3.GlobalVideoSystem.isFirstVideoChatInited()){i.GlobalVars3.GlobalVideoSystem.createFirstVideoChat(e,!1);var o=i.GlobalVars3.GlobalVideoSystem.getSingalVideoChat();o.cmd=s.GlobalCode.Request_video_chat_a_to_server_code,n.sendMessageToServer(o),i.showCallPage()}},o.makeacall=function(e){if(!n.audioorvideoWorking()&&!i.GlobalVars3.GlobalVideoSystem.isFirstVideoChatInited()){i.GlobalVars3.GlobalVideoSystem.createFirstVideoChat(e,!0);var o=i.GlobalVars3.GlobalVideoSystem.getSingalVideoChat();o.cmd=s.GlobalCode.Request_video_chat_a_to_server_code,o.audiochatonly=!0,n.sendMessageToServer(o),i.showCallPage()}}},,,,,,function(e,o,t){"use strict";o.__esModule=!0;var n=t(0),i=t(6),s=t(7),a=t(8),r=t(5);function l(){window.scrollTo(0,1)}addEventListener("load",function(){setTimeout(l,0)},!1),$(document).ready(function(e){$(".close").on("click",function(e){$(".login-form").fadeOut("slow",function(e){$(".login-form").remove()})}),n.changeBackground(),$("#a1").click(function(){""!=$("#username").val()&&""!=$("#password").val()?/^[0-9]*[1-9][0-9]*$/.test($("#username").val())?(i.setCookie("id",$("#username").val(),1),i.setCookie("passwd",$("#password").val(),1),window.location.href=n.GlobalVars2.globalMainPage):alert("请输入 用户ID, 它是一个数字，并且大于0"):alert("请输入 用户的数字ID和口令，")}),$("#a2").click(function(){window.location.href=n.GlobalVars2.globalRegisterPage}),window.removeThisFriend=s.removeThisFriend,window.videoChat=a.videoChat,window.makeacall=a.makeacall,window.audioMessage=r.audioMessage})}]);
//# sourceMappingURL=index_mob.js.map